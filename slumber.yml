# yaml-language-server: $schema=https://raw.githubusercontent.com/LucasPickering/slumber/refs/heads/4.0/schemas/collection.json

.base_profile_data:
  fish_id: "{{ response('list_fish', trigger='no_history')
    | jsonpath('$[*].id')
    | select(message='Fish ID') }}"
  session_id: "{{ response('login') | jsonpath('$.id') }}"

profiles:
  prd:
    name: Production
    data:
      $ref: "#/.base_profile_data"
      host: https://shoal.lucaspickering.me
  local_dev:
    name: Local Dev
    default: true
    data:
      $ref: "#/.base_profile_data"
      host: http://localhost:3000

.authenticated:
  headers:
    Shoal-Session-Id: "{{ session_id }}"

requests:
  login:
    name: Login (New Session)
    method: POST
    url: "{{ host }}/login"

  list_fish:
    $ref: "#/.authenticated"
    name: List Fish
    method: GET
    url: "{{ host }}/fish"
    query:
      select: "{{ select(
        ['foo', 'bar', 'baz', 'a really really really really long option'],
        message='Select a value'
        ) }}"

  get_fish:
    $ref: "#/.authenticated"
    name: Get Fish
    method: GET
    url: "{{ host }}/fish/{{ fish_id }}"

  create_fish:
    $ref: "#/.authenticated"
    name: Create Fish
    method: POST
    url: "{{ host }}/fish"
    body:
      type: json
      data:
        {
          "name": "{{ prompt(message='Name', default='Fishy') }}",
          "species": "{{ prompt(message='Species', default='Fish') }}",
          "age": "{{ prompt(message='Age', default=3) | integer() }}",
          "weight_kg": "{{ prompt(message='Weight (kg)', default='1.5') | float() }}",
        }

  modify_fish:
    $ref: "#/.authenticated"
    name: Modify Fish
    method: PATCH
    url: "{{ host }}/fish/{{ fish_id }}"
    body:
      type: json
      data:
        {
          "age": "{{ prompt(message='Age', default=3) | integer() }}",
          "weight_kg": "{{ prompt(message='Weight (kg)', default='1.5') | float() }}",
        }

  delete_fish:
    $ref: "#/.authenticated"
    name: Delete Fish
    method: DELETE
    url: "{{ host }}/fish/{{ fish_id }}"

  get_image:
    $ref: "#/.authenticated"
    headers:
      Accept: image/png,image/jpeg
    name: Get Image
    method: GET
    url: "{{ host }}/{{ fish_id }}/image"

  upload_image:
    $ref: "#/.authenticated"
    name: Upload Image
    method: POST
    url: "{{ host }}/{{ fish_id }}/image"
    body:
      type: form_multipart
      data:
        filename: "logo.png"
        image: "{{ prompt(message='Path', default='static/slumber.png') | file() }}"
